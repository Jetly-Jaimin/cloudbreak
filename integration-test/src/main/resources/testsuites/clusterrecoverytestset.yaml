name: "AWS cluster recovery tests"
parallel: tests
threadCount: 2
parameters:
  awsRegion: eu-west-1
  awsAvailabilityZone: eu-west-1a
  awsCredentialName: autotesting-clusters-aws
listeners:
  - com.sequenceiq.it.cloudbreak.newway.listener.FirstLastTestExecutionBehaviour
  - com.sequenceiq.it.cloudbreak.newway.listener.StructuredEventsReporterOnFailingCluster
tests:
  - name: "AWS manual recovery"
    preserveOrder: true
    parameters:
      clusterName: aws-e2e-test-cluster
      provider: aws
      blueprintName: "Data Science: Apache Spark 2, Apache Zeppelin"
      image: hdp
      instancegroupName: worker
      workerInstanceCount: 5
    classes:
      - name: com.sequenceiq.it.cloudbreak.RecoveryTests
        includedMethods:
        - testCreateNewRegularCluster
        - testManualRecovery
        - testTerminateCluster
  - name: "AWS manual unconditional recovery with node IDs"
    preserveOrder: true
    parameters:
      clusterName: aws-e2e-test-cluster
      provider: aws
      blueprintName: "Data Science: Apache Spark 2, Apache Zeppelin"
      image: hdp
      instancegroupName: worker
      workerInstanceCount: 5
    classes:
    - name: com.sequenceiq.it.cloudbreak.RecoveryTests
      includedMethods:
      - testCreateNewRegularCluster
      - testManualRecoveryWithNodeIds
      - testTerminateCluster
  - name: "AWS auto recovery"
    preserveOrder: true
    parameters:
      clusterName: aws-e2e-test-cluster
      provider: aws
      blueprintName: "Data Science: Apache Spark 2, Apache Zeppelin"
      image: hdp
      instancegroupName: worker
      workerRecoveryMode: auto
      workerInstanceCount: 5
    classes:
      - name: com.sequenceiq.it.cloudbreak.RecoveryTests
        includedMethods:
        - testCreateNewRegularCluster
        - testAutoRecovery
        - testTerminateCluster